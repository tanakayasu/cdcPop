require(magrittr)
require(haven)
require(data.table)
temporaryFile <- tempfile()
"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/nvss/bridged_race/pcen_v2020_y1020_sas7bdat.zip" %>%
# "https://www.cdc.gov/nchs/nvss/bridged_race/pcen_v2020_y1020_txt.zip" %>%
download.file(temporaryFile)
fileNameList <- as.character(unzip(temporaryFile, list = T)$Name)
fileNameList %>% print()
pcen2020 <- unzip(temporaryFile, fileNameList) %>%
read_sas %>%
as.data.table %>%
.[ST_FIPS == 41]
# cbind(male = seq(1, 8, 2), female = seq(2, 8, 2))# %>% as.data.table
# pcen2020 <- pcen2020[ST_FIPS == 41]
pcen2020[RACESEX %in% seq(1, 8, 2), sex := "Male"]
pcen2020[RACESEX %in% seq(2, 8, 2), sex := "Female"]
race4dt <- fread("race4, RaceName
1, White
2, Black
3, American Indian or Alaska Native
4, Asian or Pacific Islander")
pcen2020 <- pcen2020[race4dt, on = "race4"]
# dont' know why but 000 doesn't work so I had to separate 000 to 00,0
pcen2020[,PSTCO := ifelse(CO_FIPS < 10,
paste0(ST_FIPS, "00", CO_FIPS),
paste0(ST_FIPS, "0", CO_FIPS)) %>% as.numeric]
pcen2020[,.N, PSTCO]
pcen200
pcen2020
countyName.dt <- fread("countyName	CO_FIPS
Baker County	1
Benton County	3
Clackamas County	5
Clatsop County	7
Columbia County	9
Coos County	11
Crook County	13
Curry County	15
Deschutes County	17
Douglas County	19
Gilliam County	21
Grant County	23
Harney County	25
Hood River County	27
Jackson County	29
Jefferson County	31
Josephine County	33
Klamath County	35
Lake County	37
Lane County	39
Lincoln County	41
Linn County	43
Malheur County	45
Marion County	47
Morrow County	49
Multnomah County	51
Polk County	53
Sherman County	55
Tillamook County	57
Umatilla County	59
Union County	61
Wallowa County	63
Wasco County	65
Washington County	67
Wheeler County	69
Yamhill County	71")
pcen2020[countyName.dt, on = "CO_FIPS"]
countyName.dt <- fread("countyName	CO_FIPS
Baker	1
Benton	3
Clackamas	5
Clatsop	7
Columbia	9
Coos	11
Crook	13
Curry	15
Deschutes	17
Douglas	19
Gilliam	21
Grant	23
Harney	25
Hood River	27
Jackson	29
Jefferson	31
Josephine	33
Klamath	35
Lake	37
Lane	39
Lincoln	41
Linn	43
Malheur	45
Marion	47
Morrow	49
Multnomah	51
Polk	53
Sherman	55
Tillamook	57
Umatilla	59
Union	61
Wallowa	63
Wasco	65
Washington	67
Wheeler	69
Yamhill	71")
pcen2020[countyName.dt, on = "CO_FIPS"]
rm(temporaryFile)
pcen220
pcen2020
pcen2020 <- pcen2020[countyName.dt, on = "CO_FIPS"]
pcen2020
pcen2020[hisp == 2, raceName := "Hispanic"]
pcen2020
pcen2020[,.N, by = .SDcols]
pcen2020[,.SD]
pcen2020[,.SD, .sdcols]
pcen2020[,.SD, .SDcols = POP2020]
pcen2020[,.SD, .SDcols = "POP2020"]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")]
pcen2020[,raceName]
pcen2020[,.N, raceName]
# cbind(male = seq(1, 8, 2), female = seq(2, 8, 2))# %>% as.data.table
# pcen2020 <- pcen2020[ST_FIPS == 41]
pcen2020[RACESEX %in% seq(1, 8, 2), sex := "Male"]
pcen2020[RACESEX %in% seq(2, 8, 2), sex := "Female"]
race4dt <- fread("race4, RaceName
1, White
2, Black
3, American Indian or Alaska Native
4, Asian or Pacific Islander")
pcen2020 <- pcen2020[race4dt, on = "race4"]
# dont' know why but 000 doesn't work so I had to separate 000 to 00,0
pcen2020[,PSTCO := ifelse(CO_FIPS < 10,
paste0(ST_FIPS, "00", CO_FIPS),
paste0(ST_FIPS, "0", CO_FIPS)) %>% as.numeric]
pcen2020[,.N, PSTCO]
countyName.dt <- fread("countyName	CO_FIPS
Baker	1
Benton	3
Clackamas	5
Clatsop	7
Columbia	9
Coos	11
Crook	13
Curry	15
Deschutes	17
Douglas	19
Gilliam	21
Grant	23
Harney	25
Hood River	27
Jackson	29
Jefferson	31
Josephine	33
Klamath	35
Lake	37
Lane	39
Lincoln	41
Linn	43
Malheur	45
Marion	47
Morrow	49
Multnomah	51
Polk	53
Sherman	55
Tillamook	57
Umatilla	59
Union	61
Wallowa	63
Wasco	65
Washington	67
Wheeler	69
Yamhill	71")
pcen2020 <- pcen2020[countyName.dt, on = "CO_FIPS"]
pcen2020[hisp == 2 & !(is.na(hisp)), raceName := "Hispanic"]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")]
pcen2020[,.N, raceName]
pcen2020
# cbind(male = seq(1, 8, 2), female = seq(2, 8, 2))# %>% as.data.table
# pcen2020 <- pcen2020[ST_FIPS == 41]
pcen2020[RACESEX %in% seq(1, 8, 2), sex := "Male"]
pcen2020[RACESEX %in% seq(2, 8, 2), sex := "Female"]
race4dt <- fread("race4, raceName
1, White
2, Black
3, American Indian or Alaska Native
4, Asian or Pacific Islander")
pcen2020 <- pcen2020[race4dt, on = "race4"]
# dont' know why but 000 doesn't work so I had to separate 000 to 00,0
pcen2020[,PSTCO := ifelse(CO_FIPS < 10,
paste0(ST_FIPS, "00", CO_FIPS),
paste0(ST_FIPS, "0", CO_FIPS)) %>% as.numeric]
pcen2020[,.N, PSTCO]
countyName.dt <- fread("countyName	CO_FIPS
Baker	1
Benton	3
Clackamas	5
Clatsop	7
Columbia	9
Coos	11
Crook	13
Curry	15
Deschutes	17
Douglas	19
Gilliam	21
Grant	23
Harney	25
Hood River	27
Jackson	29
Jefferson	31
Josephine	33
Klamath	35
Lake	37
Lane	39
Lincoln	41
Linn	43
Malheur	45
Marion	47
Morrow	49
Multnomah	51
Polk	53
Sherman	55
Tillamook	57
Umatilla	59
Union	61
Wallowa	63
Wasco	65
Washington	67
Wheeler	69
Yamhill	71")
pcen2020 <- pcen2020[countyName.dt, on = "CO_FIPS"]
pcen2020[hisp == 2, raceName := "Hispanic"]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")]
pcen2020[,.N, raceName]
pcen2020
#Hello world!
require(magrittr)
require(haven)
require(data.table)
# https://www.cdc.gov/nchs/nvss/bridged_race/data_documentation.htm#vintage2020
# https://www.cdc.gov/nchs/data/nvss/bridged_race/Documentation-Bridged-PostcenV2020.pdf
# data dictionary starting on page 18 of th pdf
# RACESEX Bridged-race-sex Numeric
# 1=White male
# 2=White female
# 3=Black male
# 4=Black female
# 5=American Indian or Alaska Native male
# 6=American Indian or Alaska Native female
# 7=Asian or Pacific Islander male
# 8=Asian or Pacific Islander female
# HISP Hispanic origin Numeric
# 1=not Hispanic or Latino
# 2=Hispanic or Latino
temporaryFile <- tempfile()
"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/nvss/bridged_race/pcen_v2020_y1020_sas7bdat.zip" %>%
# "https://www.cdc.gov/nchs/nvss/bridged_race/pcen_v2020_y1020_txt.zip" %>%
download.file(temporaryFile)
fileNameList <- as.character(unzip(temporaryFile, list = T)$Name)
fileNameList %>% print()
pcen2020 <- unzip(temporaryFile, fileNameList) %>%
read_sas %>%
as.data.table %>%
.[ST_FIPS == 41]
# rm(temporaryFile)
# cbind(male = seq(1, 8, 2), female = seq(2, 8, 2))# %>% as.data.table
# pcen2020 <- pcen2020[ST_FIPS == 41]
pcen2020[RACESEX %in% seq(1, 8, 2), sex := "Male"]
pcen2020[RACESEX %in% seq(2, 8, 2), sex := "Female"]
race4dt <- fread("race4, raceName
1, White
2, Black
3, American Indian or Alaska Native
4, Asian or Pacific Islander")
pcen2020 <- pcen2020[race4dt, on = "race4"]
# dont' know why but 000 doesn't work so I had to separate 000 to 00,0
pcen2020[,PSTCO := ifelse(CO_FIPS < 10,
paste0(ST_FIPS, "00", CO_FIPS),
paste0(ST_FIPS, "0", CO_FIPS)) %>% as.numeric]
pcen2020[,.N, PSTCO]
countyName.dt <- fread("countyName	CO_FIPS
Baker	1
Benton	3
Clackamas	5
Clatsop	7
Columbia	9
Coos	11
Crook	13
Curry	15
Deschutes	17
Douglas	19
Gilliam	21
Grant	23
Harney	25
Hood River	27
Jackson	29
Jefferson	31
Josephine	33
Klamath	35
Lake	37
Lane	39
Lincoln	41
Linn	43
Malheur	45
Marion	47
Morrow	49
Multnomah	51
Polk	53
Sherman	55
Tillamook	57
Umatilla	59
Union	61
Wallowa	63
Wasco	65
Washington	67
Wheeler	69
Yamhill	71")
pcen2020 <- pcen2020[countyName.dt, on = "CO_FIPS"]
pcen2020[hisp == 2, raceName := "Hispanic"]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")]
pcen2020[,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")][,.N, raceName]
pcen2020[,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "age", "raceName")][,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,sum(POP2020), by = c("PSTCO", "raceName")][,.N, raceName]
pcen2020[,sum(POP2020), by = c("PSTCO", "raceName")]
pcen2020[,unique(PSTCO)]
pcen2020[, .N, PSTCO]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,pop2020 = sum(POP2020), by = c("PSTCO", "raceName")][,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,.(pop2020 = sum(POP2020)), by = c("PSTCO", "raceName")][,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,.(pop2020 = sum(POP2020)), by = c("PSTCO", "raceName")]#[,.N, raceName]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,.(pop2020 = sum(POP2020)), by = c("PSTCO", "raceName")] %>% summary#[,.N, raceName]
require(magrittr)
require(haven)
require(data.table)
temporaryFile <- tempfile()
"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/nvss/bridged_race/pcen_v2020_y1020_sas7bdat.zip" %>%
# "https://www.cdc.gov/nchs/nvss/bridged_race/pcen_v2020_y1020_txt.zip" %>%
download.file(temporaryFile)
fileNameList <- as.character(unzip(temporaryFile, list = T)$Name)
pcen2020 <- unzip(temporaryFile, fileNameList) %>%
read_sas %>%
as.data.table %>%
.[ST_FIPS == 41]
pcen2020 <- read_sas(unzip(temporaryFile, fileNameList)) %>%
as.data.table %>%
.[ST_FIPS == 41]
pcen2020 <- read_sas(unzip(temporaryFile, fileNameList)) %>%
as.data.table %>%
.[ST_FIPS == 41]
unlink(temporaryFile)
temporaryFile <- tempfile()
"https://ftp.cdc.gov/pub/Health_Statistics/NCHS/nvss/bridged_race/pcen_v2020_y1020_sas7bdat.zip" %>%
# "https://www.cdc.gov/nchs/nvss/bridged_race/pcen_v2020_y1020_txt.zip" %>%
download.file(temporaryFile)
fileNameList <- as.character(unzip(temporaryFile, list = T)$Name)
fileNameList %>% print()
pcen2020 <- unz(temporaryFile, fileNameList) %>%
read_sas %>%
as.data.table %>%
.[ST_FIPS == 41]
pcen2020
unlink(temporaryFile)
# cbind(male = seq(1, 8, 2), female = seq(2, 8, 2))# %>% as.data.table
# pcen2020 <- pcen2020[ST_FIPS == 41]
pcen2020[RACESEX %in% seq(1, 8, 2), sex := "Male"]
pcen2020[RACESEX %in% seq(2, 8, 2), sex := "Female"]
race4dt <- fread("race4, raceName
1, White
2, Black
3, American Indian or Alaska Native
4, Asian or Pacific Islander")
pcen2020 <- pcen2020[race4dt, on = "race4"]
# dont' know why but 000 doesn't work so I had to separate 000 to 00,0
pcen2020[,PSTCO := ifelse(CO_FIPS < 10,
paste0(ST_FIPS, "00", CO_FIPS),
paste0(ST_FIPS, "0", CO_FIPS)) %>% as.numeric]
pcen2020[,.N, PSTCO]
countyName.dt <- fread("countyName	CO_FIPS
Baker	1
Benton	3
Clackamas	5
Clatsop	7
Columbia	9
Coos	11
Crook	13
Curry	15
Deschutes	17
Douglas	19
Gilliam	21
Grant	23
Harney	25
Hood River	27
Jackson	29
Jefferson	31
Josephine	33
Klamath	35
Lake	37
Lane	39
Lincoln	41
Linn	43
Malheur	45
Marion	47
Morrow	49
Multnomah	51
Polk	53
Sherman	55
Tillamook	57
Umatilla	59
Union	61
Wallowa	63
Wasco	65
Washington	67
Wheeler	69
Yamhill	71")
pcen2020 <- pcen2020[countyName.dt, on = "CO_FIPS"]
pcen2020[hisp == 2, raceName := "Hispanic"]
# pcen2020[,.SD, .SDcols = "POP2020"]
pcen2020[,.(pop2020 = sum(POP2020)), by = c("PSTCO", "raceName")] %>% summary#[,.N, raceName]
pcen2020[,.N, raceName]
pcen2020
grep("POP20")
grep("POP20", names(pcen2020))
grep("POP20", names(pcen2020), value = T)
melt(pcen2020, id.vars = c("age, sex", "raceName", "PSTCO", "countyName"),
measure.vars = grep("POP20", names(pcen2020), value = T))
melt(pcen2020, id.vars = c("age", "sex", "raceName", "PSTCO", "countyName"),
measure.vars = grep("POP20", names(pcen2020), value = T))
melt(pcen2020, id.vars = c("age", "sex", "raceName", "PSTCO", "countyName"),
measure.vars = grep("POP20", names(pcen2020), value = T),
variable.name = "estimateYear",
value.name = "population")
pcen2020.long <- melt(pcen2020,
id.vars = c("age", "sex", "raceName", "PSTCO", "countyName"),
measure.vars = grep("POP20", names(pcen2020), value = T),
variable.name = "estimateYear",
value.name = "population")
